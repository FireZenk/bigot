(function(){var a,b;b=require("underscore"),a=require("fs"),exports.render=function(c,d){var e,f,g,h;return g=Array.isArray||function(a){return toString.call("[object Array]"===a)},h=function(a){return a===Object(a)},f=new RegExp("{comment [^}]+}","g"),(e=function(c,d){return b.each(d,function(i,j){var k,l,m,n,o,p,q,r,s,t;return f.test(c)&&(c=c.replace(f,"")),-1!==c.indexOf("{include "+j+"}")?(n=a.readFileSync(i,"utf-8"),c=c.replace("{include "+j+"}",n)):-1!==c.indexOf("{"+j+" ")?(s=c.indexOf("{"+j+" "),p=c.substring(s,c.length),k=p.indexOf("}"),o=p.substring(("{"+j+" ").length,k),c=c.replace("{"+j+" "+o+"}",i.call(d[""+o]))):-1!==c.indexOf("{if "+j+"}")?(i.call()?(c=c.replace("{if "+j+"}",""),s=c.lastIndexOf("{else}"),k=c.indexOf("{end "+j+"}")+6+(""+j).length,c=c.replace(c.slice(s,k),"")):(s=c.indexOf("{if "+j+"}"),k=c.lastIndexOf("{else}")+6,c=c.replace(c.slice(s,k),""),c=c.replace("{end "+j+"}","")),c):g(i)?(s=c.indexOf("{loop "+j+"}"),void 0!==s?(t=7+s+(""+j).length,k=c.indexOf("{end "+j+"}"),l=c.slice(t,k),m="",b.each(i,function(a){var c;return h(a)?(c=l,b.each(a,function(b,d){var f,h,i;return g(b)?(i=c.indexOf("{loop "+d+"}"),f=6+c.indexOf("{end "+d+"}")+(""+d).length,h=e(c.slice(i,f),a),c=c.slice(0,i)+h+c.slice(f,l.length)):c=c.replace("{"+d+"}",b)}),m+=c):m+=l.replace("{@}",a)}),q=c.slice(k,c.length),r=c.slice(0,s),c=r+m+q.replace("{end "+j+"}","")):void 0):c=c.replace("{"+j+"}",i)}),c})(c,d)}}).call(this);