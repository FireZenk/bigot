(function(){var a,b;b=require("underscore"),a=require("fs"),exports.render=function(c,d){var e,f,g,h;return g=Array.isArray||function(a){return toString.call("[object Array]"===a)},h=function(a){return a===Object(a)},f=new RegExp("{comment [^}]+}","g"),(e=function(c,d){return b.each(d,function(d,i){var j,k,l,m,n,o,p,q;return f.test(c)&&(c=c.replace(f,"")),-1!==c.indexOf("{include "+i+"}")?(m=a.readFileSync(d,"utf-8"),c=c.replace("{include "+i+"}",m)):-1!==c.indexOf("{if "+i+"}")?(d.call()?(c=c.replace("{if "+i+"}",""),p=c.lastIndexOf("{else}"),j=c.indexOf("{end "+i+"}")+6+(""+i).length,c=c.replace(c.slice(p,j),"")):(p=c.indexOf("{if "+i+"}"),j=c.lastIndexOf("{else}")+6,c=c.replace(c.slice(p,j),""),c=c.replace("{end "+i+"}","")),c):g(d)?(p=c.indexOf("{loop "+i+"}"),void 0!==p?(q=7+p+(""+i).length,j=c.indexOf("{end "+i+"}"),k=c.slice(q,j),l="",b.each(d,function(a){var c;return h(a)?(c=k,b.each(a,function(b,d){var f,h,i;return g(b)?(i=c.indexOf("{loop "+d+"}"),f=6+c.indexOf("{end "+d+"}")+(""+d).length,h=e(c.slice(i,f),a),c=c.slice(0,i)+h+c.slice(f,k.length)):c=c.replace("{"+d+"}",b)}),l+=c):l+=k.replace("{@}",a)}),n=c.slice(j,c.length),o=c.slice(0,p),c=o+l+n.replace("{end "+i+"}","")):void 0):c=c.replace("{"+i+"}",d)}),c})(c,d)}}).call(this);